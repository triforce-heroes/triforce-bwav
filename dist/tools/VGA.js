import{spawnSync as t}from"node:child_process";import{readFileSync as e,rmSync as r,writeFileSync as o}from"node:fs";import{crc32 as i}from"crc";import{root as n}from"../utils/path.js";import{createTemporaryFile as m}from"../utils/temp.js";import{copyModifiedTime as f}from"../utils/time.js";import{soxConvert as l,soxSamples as s}from"./Sox.js";let c=n("tools/vgaudio.exe");export function VGAConvert(p,w,a){let u=l(p,1),I=2===a,U=m("lopus");t(c,["-c",u,U]);let E=e(U);r(U),E.writeUInt8(0,10);let L=I?Buffer.concat([E,E]):E,h=e(n(I?"fixtures/bwav-channel-2.bwav":"fixtures/bwav-channel-1.bwav"));h.writeUInt32LE(i(L),8);let v=s(u);r(u),h.writeUInt32LE(v,24),h.writeUInt32LE(v,28),I&&(h.writeUInt32LE(v,100),h.writeUInt32LE(v,104),h.writeUInt32LE(E.length+192,140),h.writeUInt32LE(E.length+192,144)),o(w,Buffer.concat([h,L])),f(w,p)}